version: "3.8"

services:

  mongo:
    container_name: mongo
    volumes:
#      - ./Learn-Database/data:/data/db
      - ./Learn-Database/fixtures:/data/fixtures
    environment:
      MONGO_INITDB_ROOT_USERNAME: node_user
      MONGO_INITDB_ROOT_PASSWORD: learn123
      MONGO_INITDB_DATABASE: learn_db
    ports:
      - 27017
    networks:
      - internal-net

  mongo-express:
    depends_on:
      - mongo
    ports:
      - "8181:8081"
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: node_user
      ME_CONFIG_MONGODB_ADMINPASSWORD: learn123
      ME_CONFIG_MONGODB_SERVER: mongo
    networks:
      - internal-net
      - public-net

  node:
    container_name: node
    depends_on:
      - mongo
    ports:
      - "3000:3000"
    environment:
      MONGODB_URL: mongodb://node_user:learn123@mongo:27017/learn_db?authSource=admin&readPreference=primary&ssl=false
      PORT: 3000
      JWT_KEY: YOLO
    volumes:
      - ./Learn-Back/learn-studio-api:/app
      - api-node-modules:/app/node_modules      
    networks:
      - public-net
      - internal-net


  angular:
    container_name: angular
    depends_on:
      - node
    ports:
      - "4200:4200"
    environment:
      BACKEND_INTERNAL_HOST: 'http://node:3000'
      CHOKIDAR_USEPOLLING: "true"
    volumes:
      - ./Learn-Front/learn-studio-front/src:/frontend/src
#      - front-node-modules:/usr/src/app/node_modules
    networks:
      - public-net

volumes:
#  front-node-modules:
  api-node-modules:
  data:

networks: 
  public-net:
  internal-net:
